{"name":"Stripeforce","tagline":"Stripe API Client Library for Force.com","body":"Stripe SDK for Force.com\r\n========================================\r\n\r\n[Stripe](http://stripe.com) is a fantastic developer-friendly payment processing platform. This SDK was originally developed by Cirruspath in 2012. Please send comments, pull requests, and questions here on github.\r\n\r\nStripe API Documentation\r\n------------------------\r\nRead up: https://stripe.com/docs/api\r\n\r\nListening for Webhooks\r\n----------------------\r\nTo implement a listener for Stripe webhooks, start with the ExampleWebhookListener.cls class. This class isn't included in the 'src' directory to help avoid contributors' own webhook implementations from unintentionally gettting committed to this public repo or from being overwritten when they pull in the latest code.\r\n\r\nNote that not ALL Stripe webhooks are currently supported. However, support for additional webhooks can easily be added to the StripeWebhookListener class. If you make changes to it, please also include the corresponding updates to this webhook implementation class.\r\n\r\nWebhookDelayedProcessor\r\n-----------------------\r\nThere is often an \"indexing delay\" after inserting (or updating) records in Salesforce. If your Webhook implementation relies on finding existing records to complete its task (i.e. searching for the account that corresponds to a new Stripe customer), you may find the WebhookDelayedProcessor job useful. \r\n\r\nIn the example below, after searching for a 'license', we're unable to find one. We check to ensure that delayed processing is allowed (an implementation choice), and we create a `Stripe_Webhook__c` record with the webhook details. A scheduled job will then re-run the appropriate webhook handler up to 3 times, waiting 5 minutes beteween attempts -- adequate time for Salesforce indexing to catch up.\r\n\r\n```\r\npublic void handle_ChargeSucceeded(StripeCharge charge, Boolean allowDelayedProcessing) {\r\n...\r\n\t\tif (license == null) {\r\n\t\t\tif (allowDelayedProcessing) {\r\n\t\t\t\tSystem.debug(System.LoggingLevel.INFO, '\\n**** License Not Found; Delay Webhook Processing'); \r\n\t\t\t\tStripe_Webhook__c webhook = new Stripe_Webhook__c(\r\n\t\t\t\t\tWebhook_Type__c = 'charge.succeeded',\r\n\t\t\t\t\tWebhook_Data__c = JSON.serializePretty(charge)\r\n\t\t\t\t);\r\n\t\t\t\tinsert webhook;\r\n\t\t\t\treturn;\r\n\t\t\t} \r\n\t\t\t\t\r\n\t\t\tthrow new WebhookDelayedProcessor.WebhookDelayedProcessorException();\r\n\t\t}\r\n...\r\n}\r\n\r\n```\r\n\r\nNote that delayed processing is currently only implemented for the `charge.succeeded` webhook, but extending the concept to other webhooks (or making it generic) is not difficult.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}